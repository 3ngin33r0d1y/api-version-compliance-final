import{r as h,j as e}from"./index-Cy_nZQ3X.js";import{u as B}from"./useData-BjZkJB7V.js";import{S as C,T as I,C as $}from"./triangle-alert-pfKzx-Ri.js";import{S as D,R as L,G as q}from"./server-C1g08vkb.js";import{C as y}from"./circle-alert-BwgOoTu6.js";import"./createLucideIcon-BaRYqxTQ.js";function ee(){const{state:x}=B(!0),[o,M]=h.useState(null),[w,A]=h.useState(!0),[T,O]=h.useState(null),[R,z]=h.useState(null),[V,H]=h.useState(!0),S=async()=>{var r,a;A(!0),O(null);try{const s={},t=[];for(const l of x.apis)try{const v=await fetch(l.url),m=await v.json(),N=m.service||P(l.url),b=((r=x.projects.find(E=>E.id===l.projectId))==null?void 0:r.name)||"Unknown Project",g=`${N}-${l.projectId}`;s[g]||(s[g]={});const f=U(l.environment);s[g][f]={service:N,version:m.version||"0.0.0",url:l.url,status:v.ok?"online":"offline",environment:f,region:l.region||"unknown",responseTime:Math.floor(Math.random()*200)+50,projectId:l.projectId,projectName:b}}catch(v){console.error(`Failed to fetch ${l.url}:`,v);const m=P(l.url),N=((a=x.projects.find(f=>f.id===l.projectId))==null?void 0:a.name)||"Unknown Project",b=`${m}-${l.projectId}`;s[b]||(s[b]={});const g=U(l.environment);s[b][g]={service:m,version:"0.0.0",url:l.url,status:"offline",environment:g,region:l.region||"unknown",responseTime:0,projectId:l.projectId,projectName:N}}for(const[l,v]of Object.entries(s)){const m=F(v);t.push(...m)}const i=Object.keys(s).length,n=new Set(t.map(l=>`${l.service}-${l.projectName}`)).size,c=i-n,d=t.filter(l=>l.severity==="critical").length,p=t.filter(l=>l.severity==="warning").length,j=i>0?Math.round(c/i*100):100,u={services:s,violations:t,totalViolations:t.length,criticalViolations:d,warningViolations:p,compliantServices:c,totalServices:i,complianceScore:j,timestamp:new Date().toISOString()};M(u),z(new Date)}catch(s){O(s.message||"Failed to check compliance")}finally{A(!1)}},P=r=>{try{return new URL(r).hostname.split(".")[0]||"unknown-service"}catch{return"unknown-service"}},U=r=>{const a=r.toLowerCase();return a.includes("prod")?"prod":a.includes("oat")?"oat":a.includes("uat")?"uat":a.includes("dev")?"dev":a},F=r=>{var j,u;const a=[],{dev:s,uat:t,oat:i,prod:n}=r;if(!s&&!t&&!i&&!n)return a;const c=((j=Object.values(r)[0])==null?void 0:j.service)||"unknown",d=((u=Object.values(r)[0])==null?void 0:u.projectName)||"Unknown Project",p={dev:s==null?void 0:s.version,uat:t==null?void 0:t.version,oat:i==null?void 0:i.version,prod:n==null?void 0:n.version};return n!=null&&n.version&&(i!=null&&i.version)&&k(n.version,i.version)>0&&a.push({service:c,projectName:d,violation:`CRITICAL: PROD version (${n.version}) is higher than OAT version (${i.version})`,severity:"critical",environments:p}),n!=null&&n.version&&(t!=null&&t.version)&&k(n.version,t.version)>0&&a.push({service:c,projectName:d,violation:`CRITICAL: PROD version (${n.version}) is higher than UAT version (${t.version})`,severity:"critical",environments:p}),i!=null&&i.version&&(t!=null&&t.version)&&k(i.version,t.version)>0&&a.push({service:c,projectName:d,violation:`WARNING: OAT version (${i.version}) is higher than UAT version (${t.version})`,severity:"warning",environments:p}),n!=null&&n.version&&!(t!=null&&t.version)&&a.push({service:c,projectName:d,violation:`WARNING: PROD exists (${n.version}) but UAT environment is missing`,severity:"warning",environments:p}),a},k=(r,a)=>{const s=r.split(".").map(Number),t=a.split(".").map(Number),i=Math.max(s.length,t.length);for(let n=0;n<i;n++){const c=s[n]||0,d=t[n]||0;if(c!==d)return c-d}return 0};h.useEffect(()=>{x.apis.length>0&&S()},[x.apis]),h.useEffect(()=>{let r;return V&&x.apis.length>0&&(r=setInterval(S,3e4)),()=>{r&&clearInterval(r)}},[V,x.apis]);const G=r=>{switch(r){case"critical":return"text-red-700 bg-red-50 border-red-200";case"warning":return"text-yellow-700 bg-yellow-50 border-yellow-200";default:return"text-blue-700 bg-blue-50 border-blue-200"}},K=r=>{switch(r){case"critical":return e.jsx(y,{className:"h-5 w-5 text-red-600"});case"warning":return e.jsx(I,{className:"h-5 w-5 text-yellow-600"});default:return e.jsx($,{className:"h-5 w-5 text-blue-600"})}},W=r=>{switch(r){case"prod":return"bg-red-500 text-white";case"oat":return"bg-orange-500 text-white";case"uat":return"bg-yellow-500 text-white";case"dev":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}};return x.apis.length===0?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl",children:e.jsx(C,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Version compliance validation across environments"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-12 text-center",children:[e.jsx(D,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No APIs to Monitor"}),e.jsx("p",{className:"text-gray-600",children:"Add some APIs to your projects to start monitoring compliance"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl",children:e.jsx(C,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Version compliance validation across environments"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsx(L,{className:`h-4 w-4 ${w?"animate-spin":""}`}),e.jsx("span",{children:R?`Updated: ${R.toLocaleTimeString()}`:"Never updated"})]}),e.jsxs("button",{onClick:S,disabled:w,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-xl hover:from-red-700 hover:to-orange-700 disabled:opacity-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[e.jsx(L,{className:`h-4 w-4 ${w?"animate-spin":""}`}),e.jsx("span",{className:"font-medium",children:"Check Compliance"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[T&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Compliance Check Failed"}),e.jsx("p",{className:"text-red-700 mt-1",children:T})]})]})}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl",children:e.jsx(D,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Services"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.totalServices})]})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-red-500 to-red-600 rounded-xl",children:e.jsx(y,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Violations"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:o.totalViolations})]})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl",children:e.jsx(I,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Critical Issues"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:o.criticalViolations})]})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 bg-gradient-to-r rounded-xl ${o.complianceScore>=90?"from-green-500 to-emerald-600":o.complianceScore>=70?"from-yellow-500 to-orange-500":"from-red-500 to-red-600"}`,children:e.jsx(C,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Compliance Score"}),e.jsxs("p",{className:`text-3xl font-bold ${o.complianceScore>=90?"text-green-600":o.complianceScore>=70?"text-yellow-600":"text-red-600"}`,children:[o.complianceScore,"%"]})]})]})})]}),o.violations.length>0?e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden mb-8",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-red-50 to-orange-50 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(I,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{children:["Compliance Violations (",o.violations.length,")"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:o.violations.map((r,a)=>e.jsx("div",{className:`p-4 rounded-xl border-2 ${G(r.severity)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[K(r.severity),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:r.service}),e.jsxs("span",{className:"text-sm text-gray-600",children:["in ",r.projectName]})]}),e.jsx("p",{className:"text-sm mb-3",children:r.violation}),e.jsx("div",{className:"flex items-center space-x-2",children:Object.entries(r.environments).map(([s,t])=>t?e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${W(s)}`,children:[s.toUpperCase(),": v",t]},s):null)})]})]})},a))})})]}):e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-12 text-center mb-8",children:[e.jsx($,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"All Services Compliant"}),e.jsx("p",{className:"text-gray-600",children:"No version compliance violations detected across all environments"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Service Environment Matrix"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Service"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Project"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"DEV"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"UAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"OAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"PROD"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Status"})]})}),e.jsx("tbody",{children:Object.entries(o.services).map(([r,a])=>{const s=Object.values(a)[0],t=o.violations.some(i=>i.service===(s==null?void 0:s.service)&&i.projectName===(s==null?void 0:s.projectName));return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900",children:s==null?void 0:s.service}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s==null?void 0:s.projectName}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.dev?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:["v",a.dev.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.uat?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:["v",a.uat.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.oat?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:["v",a.oat.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:a.prod?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:["v",a.prod.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:t?e.jsx(y,{className:"h-5 w-5 text-red-500 mx-auto"}):e.jsx($,{className:"h-5 w-5 text-green-500 mx-auto"})})]},r)})})]})})})]})]})]})]})}export{ee as default};
