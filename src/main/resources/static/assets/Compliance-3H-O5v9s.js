import{r as p,j as e,a as j}from"./index-Bz8lcPC0.js";const b=["DEV","UAT","OAT","PROD"];function N(t){const i=(t||"").trim().toUpperCase();if(i==="DEV"||i==="UAT"||i==="OAT"||i==="PROD")return i}function E(t){try{return new URL(t.url).hostname}catch{return t.url||`api-${t.id}`}}function g(t){if(!t)return null;const u=t.trim().replace(/^v/i,"").split(".");if(u.length===0)return null;const m=u.map(o=>{const d=Number(o.replace(/[^\d].*$/g,""));return Number.isFinite(d)?d:0});return m.every(o=>Number.isInteger(o)&&o>=0)?m:null}function h(t,i){const u=g(t)??[],m=g(i)??[],o=Math.max(u.length,m.length,3);for(let d=0;d<o;d++){const x=u[d]??0,f=m[d]??0;if(x>f)return 1;if(x<f)return-1}return 0}function A(t){return t&&t.version?t.version.startsWith("v")?t.version:`v${t.version}`:"—"}function T(){const[t,i]=p.useState([]),[u,m]=p.useState(!0),[o,d]=p.useState(null);p.useEffect(()=>{let s=!0;async function c(){var r,n;try{m(!0),d(null);const{data:l}=await j.get("/data/projects");if(!s)return;i(Array.isArray(l)?l:[])}catch(l){if(!s)return;d(((r=l==null?void 0:l.response)==null?void 0:r.status)===403||((n=l==null?void 0:l.response)==null?void 0:n.status)===401?"Forbidden — please log in.":(l==null?void 0:l.message)||"Failed to load projects")}finally{s&&m(!1)}}c();const a=setInterval(c,3e4);return()=>{s=!1,clearInterval(a)}},[]);const x=p.useMemo(()=>{const s=new Map;return(t??[]).forEach(c=>{((c==null?void 0:c.apis)??[]).forEach(a=>{const r=N(a.environment);if(!r)return;const n=a.service&&a.service.trim()||E(a);s.has(n)||s.set(n,{service:n,byEnv:{DEV:void 0,UAT:void 0,OAT:void 0,PROD:void 0}});const l=s.get(n),v=l.byEnv[r];(!v||h(a.version,v.version)>=0)&&(l.byEnv[r]=a)})}),Array.from(s.values()).sort((c,a)=>c.service.localeCompare(a.service))},[t]);function f(s){var l,v,y;const c=((l=s.byEnv.UAT)==null?void 0:l.version)??null,a=((v=s.byEnv.OAT)==null?void 0:v.version)??null,r=((y=s.byEnv.PROD)==null?void 0:y.version)??null,n=[];return a&&c&&h(a,c)>0&&n.push("OAT ahead of UAT"),r&&a&&h(r,a)>0&&n.push("PROD ahead of OAT"),r&&c&&h(r,c)>0&&n.push("PROD ahead of UAT"),{compliant:n.length===0,issues:n}}return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"mb-4 text-3xl font-bold",children:"Compliance"}),u&&e.jsx("div",{className:"rounded-md border p-4 text-sm",children:"Loading…"}),o&&e.jsx("div",{className:"mb-4 rounded-md border border-red-300 bg-red-50 p-3 text-sm text-red-800",children:o}),!u&&!o&&e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs("table",{className:"min-w-full border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left text-sm font-semibold text-gray-700",children:[e.jsx("th",{className:"sticky left-0 z-10 border-b px-4 py-3 bg-gray-50",children:"Service"}),b.map(s=>e.jsx("th",{className:"border-b px-4 py-3",children:s},s)),e.jsx("th",{className:"border-b px-4 py-3",children:"Compliance"})]})}),e.jsxs("tbody",{children:[x.map(s=>{const{compliant:c,issues:a}=f(s);return e.jsxs("tr",{className:"text-sm",children:[e.jsx("td",{className:"sticky left-0 z-0 border-t px-4 py-3 bg-white font-medium",children:s.service}),b.map(r=>{var n;return e.jsx("td",{className:"border-t px-4 py-3 align-top",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("div",{className:"text-gray-900",children:A(s.byEnv[r])}),((n=s.byEnv[r])==null?void 0:n.url)&&e.jsx("div",{className:"truncate text-xs text-gray-500",children:s.byEnv[r].url})]})},r)}),e.jsx("td",{className:"border-t px-4 py-3",children:c?e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:"Compliant"}):e.jsx("div",{className:"flex flex-col gap-1",children:a.map((r,n)=>e.jsx("span",{className:"inline-flex items-center rounded-md border border-yellow-300 bg-yellow-50 px-2 py-0.5 text-xs text-yellow-900",children:r},n))})})]},s.service)}),x.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-sm text-gray-500",colSpan:b.length+2,children:"No APIs found. Add APIs first, then come back to see compliance."})})]})]})})]})}export{T as default};
