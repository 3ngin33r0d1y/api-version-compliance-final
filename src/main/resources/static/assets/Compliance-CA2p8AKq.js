import{r as p,j as e}from"./index-Cyh6PEfA.js";import{u as B}from"./useData-DV5Tyw7p.js";import{S as k,T as I,C as $}from"./triangle-alert-CCzOHS3j.js";import{S as D,R as L,G as q}from"./server-C54ndCPn.js";import{C as w}from"./circle-alert-RfO6gJnh.js";import"./createLucideIcon-D0cl6oMT.js";function ee(){const{state:x}=B(!0),[l,M]=p.useState(null),[C,A]=p.useState(!0),[T,R]=p.useState(null),[O,z]=p.useState(null),[P,H]=p.useState(!0),S=async()=>{var n,i;A(!0),R(null);try{const t={},s=[];for(const o of x.apis)try{const v=await fetch(o.url),h=await v.json(),f=h.service||V(o.url),j=((n=x.projects.find(E=>E.id===o.projectId))==null?void 0:n.name)||"Unknown Project",g=`${f}-${o.projectId}`;t[g]||(t[g]={});const y=U(o.environment);t[g][y]={service:f,version:h.version||"0.0.0",url:o.url,status:v.ok?"online":"offline",environment:y,region:o.region||"unknown",responseTime:Math.floor(Math.random()*200)+50,projectId:o.projectId,projectName:j}}catch(v){console.error(`Failed to fetch ${o.url}:`,v);const h=V(o.url),f=((i=x.projects.find(y=>y.id===o.projectId))==null?void 0:i.name)||"Unknown Project",j=`${h}-${o.projectId}`;t[j]||(t[j]={});const g=U(o.environment);t[j][g]={service:h,version:"0.0.0",url:o.url,status:"offline",environment:g,region:o.region||"unknown",responseTime:0,projectId:o.projectId,projectName:f}}for(const[o,v]of Object.entries(t)){const h=F(v);s.push(...h)}const a=Object.keys(t).length,r=new Set(s.map(o=>`${o.service}-${o.projectName}`)).size,c=a-r,d=s.filter(o=>o.severity==="critical").length,m=s.filter(o=>o.severity==="warning").length,u=a>0?Math.round(c/a*100):100,N={services:t,violations:s,totalViolations:s.length,criticalViolations:d,warningViolations:m,compliantServices:c,totalServices:a,complianceScore:u,timestamp:new Date().toISOString()};M(N),z(new Date)}catch(t){R(t.message||"Failed to check compliance")}finally{A(!1)}},V=n=>{try{return new URL(n).hostname.split(".")[0]||"unknown-service"}catch{return"unknown-service"}},U=n=>{const i=n.toLowerCase();return i.includes("prod")?"prod":i.includes("oat")?"oat":i.includes("uat")?"uat":i.includes("dev")?"dev":i},F=n=>{var u,N;const i=[],{dev:t,uat:s,oat:a,prod:r}=n;if(!t&&!s&&!a&&!r)return i;const c=((u=Object.values(n)[0])==null?void 0:u.service)||"unknown",d=((N=Object.values(n)[0])==null?void 0:N.projectName)||"Unknown Project",m={dev:t==null?void 0:t.version,uat:s==null?void 0:s.version,oat:a==null?void 0:a.version,prod:r==null?void 0:r.version};return r!=null&&r.version&&(a!=null&&a.version)&&b(r.version,a.version)>0&&i.push({service:c,projectName:d,violation:`CRITICAL: PROD version (${r.version}) is higher than OAT version (${a.version})`,severity:"critical",environments:m}),r!=null&&r.version&&(s!=null&&s.version)&&b(r.version,s.version)>0&&i.push({service:c,projectName:d,violation:`CRITICAL: PROD version (${r.version}) is higher than UAT version (${s.version})`,severity:"critical",environments:m}),a!=null&&a.version&&(s!=null&&s.version)&&b(a.version,s.version)>0&&i.push({service:c,projectName:d,violation:`WARNING: OAT version (${a.version}) is higher than UAT version (${s.version})`,severity:"warning",environments:m}),a!=null&&a.version&&(r!=null&&r.version)&&b(a.version,r.version)>0&&i.push({service:c,projectName:d,violation:`CRITICAL: OAT version (${a.version}) is higher than PROD version (${r.version})`,severity:"critical",environments:m}),s!=null&&s.version&&(r!=null&&r.version)&&b(s.version,r.version)>0&&i.push({service:c,projectName:d,violation:`CRITICAL: UAT version (${s.version}) is higher than PROD version (${r.version})`,severity:"critical",environments:m}),r!=null&&r.version&&!(s!=null&&s.version)&&i.push({service:c,projectName:d,violation:`WARNING: PROD exists (${r.version}) but UAT environment is missing`,severity:"warning",environments:m}),i},b=(n,i)=>{const t=n.split(".").map(Number),s=i.split(".").map(Number),a=Math.max(t.length,s.length);for(let r=0;r<a;r++){const c=t[r]||0,d=s[r]||0;if(c!==d)return c-d}return 0};p.useEffect(()=>{x.apis.length>0&&S()},[x.apis]),p.useEffect(()=>{let n;return P&&x.apis.length>0&&(n=setInterval(S,3e4)),()=>{n&&clearInterval(n)}},[P,x.apis]);const G=n=>{switch(n){case"critical":return"text-red-700 bg-red-50 border-red-200";case"warning":return"text-yellow-700 bg-yellow-50 border-yellow-200";default:return"text-blue-700 bg-blue-50 border-blue-200"}},K=n=>{switch(n){case"critical":return e.jsx(w,{className:"h-5 w-5 text-red-600"});case"warning":return e.jsx(I,{className:"h-5 w-5 text-yellow-600"});default:return e.jsx($,{className:"h-5 w-5 text-blue-600"})}},W=n=>{switch(n){case"prod":return"bg-red-500 text-white";case"oat":return"bg-orange-500 text-white";case"uat":return"bg-yellow-500 text-white";case"dev":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}};return x.apis.length===0?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl",children:e.jsx(k,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Version compliance validation across environments"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-12 text-center",children:[e.jsx(D,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No APIs to Monitor"}),e.jsx("p",{className:"text-gray-600",children:"Add some APIs to your projects to start monitoring compliance"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl",children:e.jsx(k,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Version compliance validation across environments"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsx(L,{className:`h-4 w-4 ${C?"animate-spin":""}`}),e.jsx("span",{children:O?`Updated: ${O.toLocaleTimeString()}`:"Never updated"})]}),e.jsxs("button",{onClick:S,disabled:C,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-xl hover:from-red-700 hover:to-orange-700 disabled:opacity-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[e.jsx(L,{className:`h-4 w-4 ${C?"animate-spin":""}`}),e.jsx("span",{className:"font-medium",children:"Check Compliance"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[T&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Compliance Check Failed"}),e.jsx("p",{className:"text-red-700 mt-1",children:T})]})]})}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl",children:e.jsx(D,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Services"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.totalServices})]})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-red-500 to-red-600 rounded-xl",children:e.jsx(w,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Violations"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:l.totalViolations})]})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl",children:e.jsx(I,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Critical Issues"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:l.criticalViolations})]})]})}),e.jsx("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 bg-gradient-to-r rounded-xl ${l.complianceScore>=90?"from-green-500 to-emerald-600":l.complianceScore>=70?"from-yellow-500 to-orange-500":"from-red-500 to-red-600"}`,children:e.jsx(k,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Compliance Score"}),e.jsxs("p",{className:`text-3xl font-bold ${l.complianceScore>=90?"text-green-600":l.complianceScore>=70?"text-yellow-600":"text-red-600"}`,children:[l.complianceScore,"%"]})]})]})})]}),l.violations.length>0?e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden mb-8",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-red-50 to-orange-50 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(I,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{children:["Compliance Violations (",l.violations.length,")"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:l.violations.map((n,i)=>e.jsx("div",{className:`p-4 rounded-xl border-2 ${G(n.severity)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[K(n.severity),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:n.service}),e.jsxs("span",{className:"text-sm text-gray-600",children:["in ",n.projectName]})]}),e.jsx("p",{className:"text-sm mb-3",children:n.violation}),e.jsx("div",{className:"flex items-center space-x-2",children:Object.entries(n.environments).map(([t,s])=>s?e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${W(t)}`,children:[t.toUpperCase(),": v",s]},t):null)})]})]})},i))})})]}):e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-12 text-center mb-8",children:[e.jsx($,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"All Services Compliant"}),e.jsx("p",{className:"text-gray-600",children:"No version compliance violations detected across all environments"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Service Environment Matrix"})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Service"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Project"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"DEV"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"UAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"OAT"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"PROD"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Status"})]})}),e.jsx("tbody",{children:Object.entries(l.services).map(([n,i])=>{const t=Object.values(i)[0],s=l.violations.some(a=>a.service===(t==null?void 0:t.service)&&a.projectName===(t==null?void 0:t.projectName));return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900",children:t==null?void 0:t.service}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:t==null?void 0:t.projectName}),e.jsx("td",{className:"py-3 px-4 text-center",children:i.dev?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:["v",i.dev.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:i.uat?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:["v",i.uat.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:i.oat?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:["v",i.oat.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:i.prod?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:["v",i.prod.version]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:s?e.jsx(w,{className:"h-5 w-5 text-red-500 mx-auto"}):e.jsx($,{className:"h-5 w-5 text-green-500 mx-auto"})})]},n)})})]})})})]})]})]})]})}export{ee as default};
