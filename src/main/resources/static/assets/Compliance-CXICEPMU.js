var Ee=t=>{throw TypeError(t)};var ae=(t,e,s)=>e.has(t)||Ee("Cannot "+s);var r=(t,e,s)=>(ae(t,e,"read from private field"),s?s.call(t):e.get(t)),p=(t,e,s)=>e.has(t)?Ee("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),u=(t,e,s,n)=>(ae(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s),b=(t,e,s)=>(ae(t,e,"access private method"),s);import{r as O,j as y,g as Be}from"./index-DiAMUAL0.js";var ge=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ze={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},N,be,Pe,He=(Pe=class{constructor(){p(this,N,ze);p(this,be,!1)}setTimeoutProvider(t){u(this,N,t)}setTimeout(t,e){return r(this,N).setTimeout(t,e)}clearTimeout(t){r(this,N).clearTimeout(t)}setInterval(t,e){return r(this,N).setInterval(t,e)}clearInterval(t){r(this,N).clearInterval(t)}},N=new WeakMap,be=new WeakMap,Pe),se=new He;function qe(t){setTimeout(t,0)}var J=typeof window>"u"||"Deno"in globalThis;function ce(){}function Ce(t){return typeof t=="number"&&t>=0&&t!==1/0}function We(t,e){return Math.max(t+(e||0)-Date.now(),0)}function G(t,e){return typeof t=="function"?t(e):t}function w(t,e){return typeof t=="function"?t(e):t}var Ke=Object.prototype.hasOwnProperty;function De(t,e){if(t===e)return t;const s=we(t)&&we(e);if(!s&&!(je(t)&&je(e)))return e;const i=(s?t:Object.keys(t)).length,c=s?e:Object.keys(e),a=c.length,o=s?new Array(a):{};let l=0;for(let m=0;m<a;m++){const g=s?m:c[m],f=t[g],x=e[g];if(f===x){o[g]=f,(s?m<i:Ke.call(t,g))&&l++;continue}if(f===null||x===null||typeof f!="object"||typeof x!="object"){o[g]=x;continue}const v=De(f,x);o[g]=v,v===f&&l++}return i===a&&l===i?t:o}function he(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function we(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function je(t){if(!Te(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!Te(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Te(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ie(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?De(t,e):e}function Ze(t,e){return typeof t=="function"?t(...e):!!t}var L,M,V,Ae,Ge=(Ae=class extends ge{constructor(){super();p(this,L);p(this,M);p(this,V);u(this,V,e=>{if(!J&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}})}onSubscribe(){r(this,M)||this.setEventListener(r(this,V))}onUnsubscribe(){var e;this.hasListeners()||((e=r(this,M))==null||e.call(this),u(this,M,void 0))}setEventListener(e){var s;u(this,V,e),(s=r(this,M))==null||s.call(this),u(this,M,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){r(this,L)!==e&&(u(this,L,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(s=>{s(e)})}isFocused(){var e;return typeof r(this,L)=="boolean"?r(this,L):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},L=new WeakMap,M=new WeakMap,V=new WeakMap,Ae),Je=new Ge;function Ne(){let t,e;const s=new Promise((i,c)=>{t=i,e=c});s.status="pending",s.catch(()=>{});function n(i){Object.assign(s,i),delete s.resolve,delete s.reject}return s.resolve=i=>{n({status:"fulfilled",value:i}),t(i)},s.reject=i=>{n({status:"rejected",reason:i}),e(i)},s}var Xe=qe;function Ye(){let t=[],e=0,s=o=>{o()},n=o=>{o()},i=Xe;const c=o=>{e?t.push(o):i(()=>{s(o)})},a=()=>{const o=t;t=[],o.length&&i(()=>{n(()=>{o.forEach(l=>{s(l)})})})};return{batch:o=>{let l;e++;try{l=o()}finally{e--,e||a()}return l},batchCalls:o=>(...l)=>{c(()=>{o(...l)})},schedule:c,setNotifyFunction:o=>{s=o},setBatchNotifyFunction:o=>{n=o},setScheduler:o=>{i=o}}}var _e=Ye(),B,F,z,Le,$e=(Le=class extends ge{constructor(){super();p(this,B,!0);p(this,F);p(this,z);u(this,z,e=>{if(!J&&window.addEventListener){const s=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",n)}}})}onSubscribe(){r(this,F)||this.setEventListener(r(this,z))}onUnsubscribe(){var e;this.hasListeners()||((e=r(this,F))==null||e.call(this),u(this,F,void 0))}setEventListener(e){var s;u(this,z,e),(s=r(this,F))==null||s.call(this),u(this,F,e(this.setOnline.bind(this)))}setOnline(e){r(this,B)!==e&&(u(this,B,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return r(this,B)}},B=new WeakMap,F=new WeakMap,z=new WeakMap,Le),et=new $e;function tt(t){return(t??"online")==="online"?et.isOnline():!0}function st(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:tt(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}var R,h,X,S,Q,H,T,U,Y,q,W,D,_,P,K,d,Z,le,ue,fe,de,pe,ye,ve,ke,Qe,rt=(Qe=class extends ge{constructor(e,s){super();p(this,d);p(this,R);p(this,h);p(this,X);p(this,S);p(this,Q);p(this,H);p(this,T);p(this,U);p(this,Y);p(this,q);p(this,W);p(this,D);p(this,_);p(this,P);p(this,K,new Set);this.options=s,u(this,R,e),u(this,U,null),u(this,T,Ne()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,h).addObserver(this),Me(r(this,h),this.options)?b(this,d,Z).call(this):this.updateResult(),b(this,d,de).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return me(r(this,h),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return me(r(this,h),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,b(this,d,pe).call(this),b(this,d,ye).call(this),r(this,h).removeObserver(this)}setOptions(e){const s=this.options,n=r(this,h);if(this.options=r(this,R).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof w(this.options.enabled,r(this,h))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");b(this,d,ve).call(this),r(this,h).setOptions(this.options),s._defaulted&&!he(this.options,s)&&r(this,R).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,h),observer:this});const i=this.hasListeners();i&&Fe(r(this,h),n,this.options,s)&&b(this,d,Z).call(this),this.updateResult(),i&&(r(this,h)!==n||w(this.options.enabled,r(this,h))!==w(s.enabled,r(this,h))||G(this.options.staleTime,r(this,h))!==G(s.staleTime,r(this,h)))&&b(this,d,le).call(this);const c=b(this,d,ue).call(this);i&&(r(this,h)!==n||w(this.options.enabled,r(this,h))!==w(s.enabled,r(this,h))||c!==r(this,P))&&b(this,d,fe).call(this,c)}getOptimisticResult(e){const s=r(this,R).getQueryCache().build(r(this,R),e),n=this.createResult(s,e);return nt(this,n)&&(u(this,S,n),u(this,H,this.options),u(this,Q,r(this,h).state)),n}getCurrentResult(){return r(this,S)}trackResult(e,s){return new Proxy(e,{get:(n,i)=>(this.trackProp(i),s==null||s(i),i==="promise"&&!this.options.experimental_prefetchInRender&&r(this,T).status==="pending"&&r(this,T).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(n,i))})}trackProp(e){r(this,K).add(e)}getCurrentQuery(){return r(this,h)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,R).defaultQueryOptions(e),n=r(this,R).getQueryCache().build(r(this,R),s);return n.fetch().then(()=>this.createResult(n,s))}fetch(e){return b(this,d,Z).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,S)))}createResult(e,s){var Oe;const n=r(this,h),i=this.options,c=r(this,S),a=r(this,Q),o=r(this,H),m=e!==n?e.state:r(this,X),{state:g}=e;let f={...g},x=!1,v;if(s._optimisticResults){const C=this.hasListeners(),ee=!C&&Me(e,s),k=C&&Fe(e,n,s,i);(ee||k)&&(f={...f,...st(g.data,e.options)}),s._optimisticResults==="isRestoring"&&(f.fetchStatus="idle")}let{error:I,errorUpdatedAt:A,status:E}=f;v=f.data;let $=!1;if(s.placeholderData!==void 0&&v===void 0&&E==="pending"){let C;c!=null&&c.isPlaceholderData&&s.placeholderData===(o==null?void 0:o.placeholderData)?(C=c.data,$=!0):C=typeof s.placeholderData=="function"?s.placeholderData((Oe=r(this,W))==null?void 0:Oe.state.data,r(this,W)):s.placeholderData,C!==void 0&&(E="success",v=Ie(c==null?void 0:c.data,C,s),x=!0)}if(s.select&&v!==void 0&&!$)if(c&&v===(a==null?void 0:a.data)&&s.select===r(this,Y))v=r(this,q);else try{u(this,Y,s.select),v=s.select(v),v=Ie(c==null?void 0:c.data,v,s),u(this,q,v),u(this,U,null)}catch(C){u(this,U,C)}r(this,U)&&(I=r(this,U),v=r(this,q),A=Date.now(),E="error");const re=f.fetchStatus==="fetching",ie=E==="pending",ne=E==="error",Se=ie&&re,Re=v!==void 0,j={status:E,fetchStatus:f.fetchStatus,isPending:ie,isSuccess:E==="success",isError:ne,isInitialLoading:Se,isLoading:Se,data:v,dataUpdatedAt:f.dataUpdatedAt,error:I,errorUpdatedAt:A,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>m.dataUpdateCount||f.errorUpdateCount>m.errorUpdateCount,isFetching:re,isRefetching:re&&!ie,isLoadingError:ne&&!Re,isPaused:f.fetchStatus==="paused",isPlaceholderData:x,isRefetchError:ne&&Re,isStale:xe(e,s),refetch:this.refetch,promise:r(this,T),isEnabled:w(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const C=te=>{j.status==="error"?te.reject(j.error):j.data!==void 0&&te.resolve(j.data)},ee=()=>{const te=u(this,T,j.promise=Ne());C(te)},k=r(this,T);switch(k.status){case"pending":e.queryHash===n.queryHash&&C(k);break;case"fulfilled":(j.status==="error"||j.data!==k.value)&&ee();break;case"rejected":(j.status!=="error"||j.error!==k.reason)&&ee();break}}return j}updateResult(){const e=r(this,S),s=this.createResult(r(this,h),this.options);if(u(this,Q,r(this,h).state),u(this,H,this.options),r(this,Q).data!==void 0&&u(this,W,r(this,h)),he(s,e))return;u(this,S,s);const n=()=>{if(!e)return!0;const{notifyOnChangeProps:i}=this.options,c=typeof i=="function"?i():i;if(c==="all"||!c&&!r(this,K).size)return!0;const a=new Set(c??r(this,K));return this.options.throwOnError&&a.add("error"),Object.keys(r(this,S)).some(o=>{const l=o;return r(this,S)[l]!==e[l]&&a.has(l)})};b(this,d,ke).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&b(this,d,de).call(this)}},R=new WeakMap,h=new WeakMap,X=new WeakMap,S=new WeakMap,Q=new WeakMap,H=new WeakMap,T=new WeakMap,U=new WeakMap,Y=new WeakMap,q=new WeakMap,W=new WeakMap,D=new WeakMap,_=new WeakMap,P=new WeakMap,K=new WeakMap,d=new WeakSet,Z=function(e){b(this,d,ve).call(this);let s=r(this,h).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(ce)),s},le=function(){b(this,d,pe).call(this);const e=G(this.options.staleTime,r(this,h));if(J||r(this,S).isStale||!Ce(e))return;const n=We(r(this,S).dataUpdatedAt,e)+1;u(this,D,se.setTimeout(()=>{r(this,S).isStale||this.updateResult()},n))},ue=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,h)):this.options.refetchInterval)??!1},fe=function(e){b(this,d,ye).call(this),u(this,P,e),!(J||w(this.options.enabled,r(this,h))===!1||!Ce(r(this,P))||r(this,P)===0)&&u(this,_,se.setInterval(()=>{(this.options.refetchIntervalInBackground||Je.isFocused())&&b(this,d,Z).call(this)},r(this,P)))},de=function(){b(this,d,le).call(this),b(this,d,fe).call(this,b(this,d,ue).call(this))},pe=function(){r(this,D)&&(se.clearTimeout(r(this,D)),u(this,D,void 0))},ye=function(){r(this,_)&&(se.clearInterval(r(this,_)),u(this,_,void 0))},ve=function(){const e=r(this,R).getQueryCache().build(r(this,R),this.options);if(e===r(this,h))return;const s=r(this,h);u(this,h,e),u(this,X,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},ke=function(e){_e.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,S))}),r(this,R).getQueryCache().notify({query:r(this,h),type:"observerResultsUpdated"})})},Qe);function it(t,e){return w(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Me(t,e){return it(t,e)||t.state.data!==void 0&&me(t,e,e.refetchOnMount)}function me(t,e,s){if(w(e.enabled,t)!==!1&&G(e.staleTime,t)!=="static"){const n=typeof s=="function"?s(t):s;return n==="always"||n!==!1&&xe(t,e)}return!1}function Fe(t,e,s,n){return(t!==e||w(n.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&xe(t,s)}function xe(t,e){return w(e.enabled,t)!==!1&&t.isStaleByTime(G(e.staleTime,t))}function nt(t,e){return!he(t.getCurrentResult(),e)}var at=O.createContext(void 0),ot=t=>{const e=O.useContext(at);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Ve=O.createContext(!1),ct=()=>O.useContext(Ve);Ve.Provider;function ht(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var lt=O.createContext(ht()),ut=()=>O.useContext(lt),ft=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},dt=t=>{O.useEffect(()=>{t.clearReset()},[t])},pt=({result:t,errorResetBoundary:e,throwOnError:s,query:n,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&n&&(i&&t.data===void 0||Ze(s,[t.error,n])),yt=t=>{if(t.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),n=t.staleTime;t.staleTime=typeof n=="function"?(...i)=>s(n(...i)):s(n),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},vt=(t,e)=>t.isLoading&&t.isFetching&&!e,mt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Ue=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function bt(t,e,s){var f,x,v,I,A;const n=ct(),i=ut(),c=ot(),a=c.defaultQueryOptions(t);(x=(f=c.getDefaultOptions().queries)==null?void 0:f._experimental_beforeQuery)==null||x.call(f,a),a._optimisticResults=n?"isRestoring":"optimistic",yt(a),ft(a,i),dt(i);const o=!c.getQueryCache().get(a.queryHash),[l]=O.useState(()=>new e(c,a)),m=l.getOptimisticResult(a),g=!n&&t.subscribed!==!1;if(O.useSyncExternalStore(O.useCallback(E=>{const $=g?l.subscribe(_e.batchCalls(E)):ce;return l.updateResult(),$},[l,g]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),O.useEffect(()=>{l.setOptions(a)},[a,l]),mt(a,m))throw Ue(a,l,i);if(pt({result:m,errorResetBoundary:i,throwOnError:a.throwOnError,query:c.getQueryCache().get(a.queryHash),suspense:a.suspense}))throw m.error;if((I=(v=c.getDefaultOptions().queries)==null?void 0:v._experimental_afterQuery)==null||I.call(v,a,m),a.experimental_prefetchInRender&&!J&&vt(m,n)){const E=o?Ue(a,l,i):(A=c.getQueryCache().get(a.queryHash))==null?void 0:A.promise;E==null||E.catch(ce).finally(()=>{l.updateResult()})}return a.notifyOnChangeProps?m:l.trackResult(m)}function gt(t,e){return bt(t,rt)}function oe(t,e){const s=a=>String(a??"").split(".").map(o=>Number.parseInt(o,10)).filter(o=>Number.isFinite(o)),n=s(t),i=s(e),c=Math.max(n.length,i.length);for(let a=0;a<c;a++){const o=n[a]??0,l=i[a]??0;if(o<l)return-1;if(o>l)return 1}return 0}function Et(){const{data:t}=gt({queryKey:["projects-with-apis"],queryFn:async()=>{const{data:i}=await Be("/data/projects");return i},refetchInterval:3e4}),e=O.useMemo(()=>t?Array.isArray(t)?t:Array.isArray(t.projects)?t.projects:[]:[],[t]),s=O.useMemo(()=>{const i=e.map(a=>Array.isArray(a.apis)?a.apis:[]).reduce((a,o)=>a.concat(o),[]),c=new Map;for(const a of i){const o=(a.service??xt(a.url)??"unknown").toLowerCase();c.has(o)||c.set(o,[]),c.get(o).push(a)}return c},[e]),n=O.useMemo(()=>{const i=[];for(const[c,a]of s.entries()){const o=v=>{var I;return((I=a.find(A=>(A.environment??"").toUpperCase()===v))==null?void 0:I.version)??null},l=o("DEV"),m=o("UAT"),g=o("OAT"),f=o("PROD"),x=[];oe(f,g)<0&&x.push("Violation: PROD version is lower than OAT"),oe(g,m)<0&&x.push("Violation: OAT version is lower than UAT"),oe(m,l)<0&&x.push("Violation: UAT version is lower than DEV"),i.push({service:c,versions:{DEV:l,UAT:m,OAT:g,PROD:f},violations:x})}return i.sort((c,a)=>c.service.localeCompare(a.service)),i},[s]);return y.jsxs("div",{className:"p-4",children:[y.jsx("h1",{className:"mb-4 text-2xl font-semibold",children:"Compliance"}),y.jsx("div",{className:"overflow-x-auto rounded border",children:y.jsxs("table",{className:"min-w-full text-sm",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-3 py-2 text-left",children:"Service"}),y.jsx("th",{className:"px-3 py-2 text-left",children:"DEV"}),y.jsx("th",{className:"px-3 py-2 text-left",children:"UAT"}),y.jsx("th",{className:"px-3 py-2 text-left",children:"OAT"}),y.jsx("th",{className:"px-3 py-2 text-left",children:"PROD"}),y.jsx("th",{className:"px-3 py-2 text-left",children:"Compliance"})]})}),y.jsxs("tbody",{children:[n.map(i=>y.jsxs("tr",{className:"border-t",children:[y.jsx("td",{className:"px-3 py-2 font-medium",children:i.service}),y.jsx("td",{className:"px-3 py-2",children:i.versions.DEV??"—"}),y.jsx("td",{className:"px-3 py-2",children:i.versions.UAT??"—"}),y.jsx("td",{className:"px-3 py-2",children:i.versions.OAT??"—"}),y.jsx("td",{className:"px-3 py-2",children:i.versions.PROD??"—"}),y.jsx("td",{className:"px-3 py-2",children:i.violations.length===0?y.jsx("span",{className:"rounded bg-green-100 px-2 py-0.5 text-green-700",children:"Compliant"}):y.jsx("div",{className:"space-y-1",children:i.violations.map((c,a)=>y.jsx("div",{className:"rounded border border-red-300 bg-red-50 px-2 py-0.5 text-red-700",children:c},a))})})]},i.service)),n.length===0&&y.jsx("tr",{children:y.jsx("td",{className:"px-3 py-6 text-gray-500",colSpan:6,children:"No services found."})})]})]})})]})}function xt(t){if(!t)return null;try{const e=new URL(t),s=e.pathname.split("/").filter(Boolean);return s[s.length-1]||e.hostname}catch{return null}}export{Et as default};
