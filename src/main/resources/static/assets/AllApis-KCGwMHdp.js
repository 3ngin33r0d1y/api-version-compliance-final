import{r as l,j as e,b as Z,c as f,d as ee}from"./index-OE6KsASD.js";import{S as A,R as se}from"./server-Cx7nIp_C.js";import{P as S,S as te,T as re}from"./trash-2-YI4a0K_y.js";import{C as ae}from"./circle-alert-CWIibe72.js";import{G as V}from"./globe-BS2NR7BS.js";import{c as ne}from"./createLucideIcon-UNcg3HFc.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=ne("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),v=["DEV","UAT","OAT","PROD"],G=t=>{const o=(t||"").toUpperCase();return v.includes(o)?o:o.startsWith("PRD")||o.startsWith("PROD")?"PROD":o.includes("UAT")?"UAT":o.includes("OAT")?"OAT":"DEV"},le=({status:t})=>{const o=(t||"unknown").toLowerCase();let c="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border";return o==="online"?c+=" bg-green-100 text-green-800 border-green-300":o==="offline"?c+=" bg-red-100 text-red-800 border-red-300":c+=" bg-gray-100 text-gray-800 border-gray-300",e.jsx("span",{className:c,children:o})},J=({open:t,onClose:o,title:c,children:y,footer:g})=>t?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:o}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-lg bg-white rounded-2xl shadow-2xl border border-white/20",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-blue-50",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(S,{className:"h-5 w-5 text-indigo-600"}),e.jsx("span",{children:c})]})}),e.jsx("div",{className:"px-6 py-6",children:y}),e.jsx("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 bg-gray-50/50",children:g})]})})]}):null;function ue(){const[t,o]=l.useState(null),[c,y]=l.useState(!1),[g,k]=l.useState(null),[W,h]=l.useState(!1),[m,C]=l.useState(null),[u,R]=l.useState(""),[I,B]=l.useState("DEV"),[U,_]=l.useState("paris-1"),[j,b]=l.useState(!1),[H,N]=l.useState(!1),[O,D]=l.useState(null),[w,T]=l.useState(""),[F,L]=l.useState("DEV"),[M,$]=l.useState("paris-1"),p=async()=>{var s,i,a;y(!0),k(null);try{const r=await f.get("/data/projects");o(r.data),m==null&&((s=r.data.projects)!=null&&s.length)&&C(r.data.projects[0].id)}catch(r){const n=r;((i=n.response)==null?void 0:i.status)===401||((a=n.response)==null?void 0:a.status)===403?k("Forbidden (403) — you are not authorized. Please log in again."):k("Failed to load projects. Check server logs.")}finally{y(!1)}};l.useEffect(()=>{p();const s=window.setInterval(p,3e4);return()=>window.clearInterval(s)},[]);const E=l.useMemo(()=>{var r;if(!t)return[];const s=t.apisMeta||{},i=new Map,a=((r=t.allApis)!=null&&r.length?t.allApis:t.apis)||[];for(const n of a){const x=s[String(n.id)]||{};let d=x.service;if(!d)try{d=new URL(n.url).hostname}catch{d="unknown-service"}const z=G(n.environment),P=i.get(d)||{service:d,byEnv:{}},q=P.byEnv[z]||{};q[n.region]={version:x.version,url:n.url,status:n.status||"unknown",apiId:n.id},P.byEnv[z]=q,i.set(d,P)}return Array.from(i.values()).sort((n,x)=>n.service.localeCompare(x.service))},[t]),Y=async()=>{var s,i;if(!(!m||!u)){b(!0);try{const a=await ee.get(u,{timeout:8e3}),{version:r,service:n}=a.data||{};if(!r||!n){alert('The endpoint must return JSON like: {"version":"1.0.0","service":"api-name"}'),b(!1);return}await f.post(`/data/projects/${m}/apis`,{url:u.trim(),environment:I,region:U,version:r,service:n});try{await f.post("/proxy/check",{url:u.trim()})}catch{}h(!1),R(""),p()}catch(a){const r=a;((s=r.response)==null?void 0:s.status)===401||((i=r.response)==null?void 0:i.status)===403?alert("Unauthorized. Please log in again."):alert("URL check or save failed. Ensure the URL is reachable and returns the required JSON."),console.error(a)}finally{b(!1)}}},K=s=>{var r;const a=(((r=t==null?void 0:t.allApis)!=null&&r.length?t.allApis:t==null?void 0:t.apis)||[]).find(n=>n.id===s);a&&(D(a),T(a.url),L(G(a.environment)),$(a.region),N(!0))},Q=async()=>{var s,i;if(!(!O||!w)){b(!0);try{await f.put(`/data/apis/${O.id}`,{url:w.trim(),environment:F,region:M}),N(!1),D(null),p()}catch(a){const r=a;((s=r.response)==null?void 0:s.status)===401||((i=r.response)==null?void 0:i.status)===403?alert("Unauthorized. Please log in again."):alert("Failed to update API. Please try again."),console.error(a)}finally{b(!1)}}},X=async s=>{var i,a;if(window.confirm("Are you sure you want to delete this API?"))try{await f.delete(`/data/apis/${s}`),p()}catch(r){const n=r;((i=n.response)==null?void 0:i.status)===401||((a=n.response)==null?void 0:a.status)===403?alert("Unauthorized. Please log in again."):alert("Failed to delete API. Please try again."),console.error(r)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl",children:e.jsx(A,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"All APIs"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Monitor and manage all your API endpoints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs("span",{children:[E.length," Services"]})]}),e.jsxs("button",{onClick:()=>h(!0),disabled:!!g,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Add API"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ae,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Authentication Error"}),e.jsx("p",{className:"text-red-700 mt-1",children:g}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:'Make sure your login saves a JWT into localStorage["token"].'})]})]})}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{children:"Service Matrix"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c?"Refreshing services...":`Last updated ${t!=null&&t.fetchedAt?new Date(t.fetchedAt).toLocaleString():""}`})]}),e.jsxs("button",{onClick:p,disabled:c,className:"flex items-center space-x-2 px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:[e.jsx(se,{className:`h-4 w-4 ${c?"animate-spin":""}`}),e.jsx("span",{className:"text-sm",children:"Refresh"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px] grid grid-cols-[1.2fr,1fr,1fr,1fr,1fr] gap-0 border border-gray-200 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 font-semibold bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-2 text-gray-600"}),"Service"]}),v.map(s=>e.jsx("div",{className:"px-4 py-3 font-semibold bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 text-center last:border-r-0",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s==="PROD"?"bg-red-100 text-red-800":s==="OAT"?"bg-orange-100 text-orange-800":s==="UAT"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s})},s)),E.map((s,i)=>e.jsxs(Z.Fragment,{children:[e.jsx("div",{className:`px-4 py-4 border-r border-gray-200 flex items-center ${i%2===0?"bg-white":"bg-gray-50/50"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"p-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded",children:e.jsx(V,{className:"h-3 w-3 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900",children:s.service})]})}),v.map(a=>{const r=s.byEnv[a]||{},n=Object.keys(r);return e.jsx("div",{className:`px-4 py-4 border-r border-gray-200 last:border-r-0 ${i%2===0?"bg-white":"bg-gray-50/50"}`,children:n.length>0?e.jsx("div",{className:"space-y-3",children:n.map(x=>{const d=r[x];return e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase",children:x}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(le,{status:d.status}),e.jsx("button",{onClick:()=>K(d.apiId),className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit API",children:e.jsx(te,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>X(d.apiId),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete API",children:e.jsx(re,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"text-sm font-mono text-gray-900 mb-1",children:["v",d.version||"?"]}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[180px] mb-2",children:d.url}),e.jsxs("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-1 text-xs text-blue-600 hover:text-blue-800 transition-colors",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsx("span",{children:"Test"})]})]},x)})}):e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-400 text-sm italic",children:"No deployment"})})},`${s.service}-${a}`)})]},s.service)),!c&&E.length===0&&e.jsxs("div",{className:"col-span-5 px-6 py-12 text-center bg-gray-50/50",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mb-2",children:"No APIs Yet"}),e.jsx("div",{className:"text-sm text-gray-500 mb-4",children:"Get started by adding your first API endpoint"}),e.jsxs("button",{onClick:()=>h(!0),disabled:!!g,className:"inline-flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:"Add First API"})]})]})]})})})]}),e.jsx(J,{open:W,onClose:()=>h(!1),title:"Add New API",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",disabled:j||!m||!u,className:"px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200",onClick:Y,children:j?"Saving…":"Save API"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),e.jsxs("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:(m==null?void 0:m.toString())||"",onChange:s=>C(parseInt(s.target.value,10)),children:[e.jsx("option",{value:"",disabled:!0,children:"Select project"}),((t==null?void 0:t.projects)||[]).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API URL"}),e.jsx("input",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"https://api.example.com/health",value:u,onChange:s=>R(s.target.value)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 bg-blue-50 p-2 rounded-lg",children:[e.jsx("strong",{children:"Required:"})," Endpoint must return ",e.jsx("code",{className:"bg-white px-1 rounded",children:'{ "version": "x.y.z", "service": "name" }'})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsxs("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:U,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"paris-1",children:"Paris 1"}),e.jsx("option",{value:"paris-2",children:"Paris 2"}),e.jsx("option",{value:"north-1",children:"North 1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsx("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:I,onChange:s=>B(s.target.value),children:v.map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]})}),e.jsx(J,{open:H,onClose:()=>N(!1),title:"Edit API",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",disabled:j||!w,className:"px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200",onClick:Q,children:j?"Updating…":"Update API"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API URL"}),e.jsx("input",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"https://api.example.com/health",value:w,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsxs("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:M,onChange:s=>$(s.target.value),children:[e.jsx("option",{value:"paris-1",children:"Paris 1"}),e.jsx("option",{value:"paris-2",children:"Paris 2"}),e.jsx("option",{value:"north-1",children:"North 1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsx("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:F,onChange:s=>L(s.target.value),children:v.map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]})})]})]})}export{ue as default};
