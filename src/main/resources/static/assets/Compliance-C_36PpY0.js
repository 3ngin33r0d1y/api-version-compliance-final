import{r as c,j as e}from"./index-b1e-KDoT.js";import{u as J}from"./useData-D0_KGheE.js";import{S as y,C as N,T as V,n as q,c as H}from"./compliance-DWgapd0z.js";import{S as $,R as b}from"./server-og_nac2Z.js";import{C as E}from"./circle-alert-DKGmh3_d.js";import"./createLucideIcon-7608Xzvb.js";function te(){const{state:a}=J(!0),[r,p]=c.useState(null),[o,h]=c.useState(!0),[w,S]=c.useState(null),[k,U]=c.useState(null),[j,O]=c.useState(!0),M=t=>{try{return new URL(t).hostname.split(".")[0]||"unknown-service"}catch{return"unknown-service"}},P=async(t,n=8e3)=>{const l=new AbortController,d=setTimeout(()=>l.abort(),n);try{return await fetch(t,{signal:l.signal})}finally{clearTimeout(d)}},z=async t=>{try{return await t.json()}catch{return{}}},v=async()=>{h(!0),S(null);try{const t={},n=a.apis??[],d=(await Promise.allSettled(n.map(async s=>{var R;let m=null,i={};try{m=await P(s.url),i=await z(m)}catch{}const A=q(s.environment),T=(i==null?void 0:i.service)||M(s.url),W=((R=a.projects.find(G=>G.id===s.projectId))==null?void 0:R.name)||"Unknown Project",f=`${T}-${s.projectId}`;t[f]||(t[f]={}),t[f][A]={service:T,version:typeof(i==null?void 0:i.version)=="string"&&i.version.trim()?i.version:"0.0.0",url:s.url,status:m!=null&&m.ok?"online":"offline",environment:A,region:s.region||"unknown",responseTime:m?Math.floor(Math.random()*200)+50:0,projectId:s.projectId,projectName:W}}))).every(s=>s.status==="rejected");if(n.length>0&&d)throw new Error("All API checks failed (network/CORS/timeout).");const x=[];for(const[,s]of Object.entries(t))x.push(...H(s));const g=Object.keys(t).length,B=new Set(x.map(s=>`${s.service}-${s.projectName}`)).size,C=Math.max(g-B,0),D=x.filter(s=>s.severity==="critical").length,F=x.filter(s=>s.severity==="warning").length,K=g>0?Math.round(C/g*100):100;p({services:t,violations:x,totalViolations:x.length,criticalViolations:D,warningViolations:F,compliantServices:C,totalServices:g,complianceScore:K,timestamp:new Date().toISOString()}),U(new Date)}catch(t){S((t==null?void 0:t.message)||"Failed to check compliance")}finally{h(!1)}};c.useEffect(()=>{a.apis.length>0?v():(h(!1),p(null))},[a.apis]),c.useEffect(()=>{if(!j||a.apis.length===0)return;const t=setInterval(v,3e4);return()=>clearInterval(t)},[j,a.apis]);const I=t=>{switch(t){case"critical":return e.jsx(E,{className:"h-5 w-5 text-red-600"});case"warning":return e.jsx(V,{className:"h-5 w-5 text-yellow-600"});default:return e.jsx(N,{className:"h-5 w-5 text-blue-600"})}},L=t=>{switch(t){case"prod":return"bg-red-500 text-white";case"oat":return"bg-orange-500 text-white";case"uat":return"bg-yellow-500 text-white";case"dev":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}};return a.apis.length===0?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl",children:e.jsx(y,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Version compliance validation across environments"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-12 text-center",children:[e.jsx($,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No APIs to Monitor"}),e.jsx("p",{className:"text-gray-600",children:"Add some APIs to your projects to start monitoring compliance"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-xl",children:e.jsx(y,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Compliance Monitoring"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Version compliance validation across environments"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsx(b,{className:`h-4 w-4 ${o?"animate-spin":""}`}),e.jsx("span",{children:k?`Updated: ${k.toLocaleTimeString()}`:"Never updated"})]}),e.jsxs("button",{onClick:v,disabled:o,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-xl hover:from-red-700 hover:to-orange-700 disabled:opacity-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[e.jsx(b,{className:`h-4 w-4 ${o?"animate-spin":""}`}),e.jsx("span",{className:"font-medium",children:"Check Compliance"})]}),e.jsxs("label",{className:"ml-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",className:"mr-2 align-middle",checked:j,onChange:t=>O(t.target.checked)}),"Auto-refresh"]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 pt-6",children:e.jsxs("div",{className:"bg-white/80 border border-gray-200 rounded-xl p-4 text-sm text-gray-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Compliance rules:"}),e.jsxs("ul",{className:"list-disc ml-6",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Rule A:"})," PROD version can’t be higher than OAT or UAT."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"Rule B:"})," OAT version can’t be higher than UAT."]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-6 space-y-8",children:[r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(u,{title:"Compliance Score",value:`${r.complianceScore}%`,icon:e.jsx(y,{className:"h-6 w-6"}),color:"blue"}),e.jsx(u,{title:"Total Services",value:r.totalServices,icon:e.jsx($,{className:"h-6 w-6"}),color:"indigo"}),e.jsx(u,{title:"Compliant Services",value:r.compliantServices,icon:e.jsx(N,{className:"h-6 w-6"}),color:"green"}),e.jsx(u,{title:"Total Violations",value:r.totalViolations,icon:e.jsx(V,{className:"h-6 w-6"}),color:"red"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20",children:[e.jsx("div",{className:"p-6 border-b border-gray-200/50",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Compliance Violations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200/50",children:[e.jsx("thead",{className:"bg-gray-50/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Service"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Project"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Violation"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Environments"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200/50",children:o?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-12",children:[e.jsx(b,{className:"h-8 w-8 text-gray-400 mx-auto animate-spin"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Checking compliance..."})]})}):w?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-12",children:[e.jsx(E,{className:"h-8 w-8 text-red-500 mx-auto"}),e.jsx("p",{className:"text-red-600 mt-2",children:w})]})}):(r==null?void 0:r.violations.length)===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-green-500 mx-auto"}),e.jsx("p",{className:"text-green-700 font-semibold mt-2",children:"All services are compliant!"})]})}):r==null?void 0:r.violations.map((t,n)=>e.jsxs("tr",{className:t.severity==="critical"?"bg-red-50/50":"bg-yellow-50/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[I(t.severity),e.jsx("span",{className:"font-medium text-gray-900",children:t.service})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.projectName}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-800",children:t.violation}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex space-x-2",children:Object.entries(t.environments).map(([l,d])=>d&&e.jsxs("div",{className:`px-2 py-1 text-xs font-bold rounded-full ${L(l)}`,children:[l.toUpperCase(),": ",d]},l))})})]},n))})]})})]})]})]})}function u({title:a,value:r,icon:p,color:o}){const h={blue:"from-blue-500 to-indigo-600",indigo:"from-indigo-500 to-purple-600",green:"from-green-500 to-emerald-600",red:"from-red-500 to-orange-600"}[o]||"from-gray-500 to-gray-600";return e.jsx("div",{className:`bg-gradient-to-br ${h} text-white rounded-2xl shadow-lg p-6`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium opacity-80",children:a}),e.jsx("p",{className:"text-3xl font-bold",children:r})]}),e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:p})]})})}export{te as default};
