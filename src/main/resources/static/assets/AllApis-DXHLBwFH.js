import{r as c,j as e,b as F,c as k,d as $}from"./index-Cy_nZQ3X.js";import{S as f,G as U,R as q}from"./server-C1g08vkb.js";import{P as S}from"./plus-C2L9Xn1t.js";import{C as z}from"./circle-alert-BwgOoTu6.js";import{c as V}from"./createLucideIcon-BaRYqxTQ.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=V("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),v=["DEV","UAT","OAT","PROD"],J=r=>{const n=(r||"").toUpperCase();return v.includes(n)?n:n.startsWith("PRD")||n.startsWith("PROD")?"PROD":n.includes("UAT")?"UAT":n.includes("OAT")?"OAT":"DEV"},W=({status:r})=>{const n=(r||"unknown").toLowerCase();let o="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border";return n==="online"?o+=" bg-green-100 text-green-800 border-green-300":n==="offline"?o+=" bg-red-100 text-red-800 border-red-300":o+=" bg-gray-100 text-gray-800 border-gray-300",e.jsx("span",{className:o,children:n})},B=({open:r,onClose:n,title:o,children:p,footer:g})=>r?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:n}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-lg bg-white rounded-2xl shadow-2xl border border-white/20",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-blue-50",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(S,{className:"h-5 w-5 text-indigo-600"}),e.jsx("span",{children:o})]})}),e.jsx("div",{className:"px-6 py-6",children:p}),e.jsx("div",{className:"flex items-center justify-end gap-3 border-t border-gray-200 px-6 py-4 bg-gray-50/50",children:g})]})})]}):null;function X(){const[r,n]=c.useState(null),[o,p]=c.useState(!1),[g,j]=c.useState(null),[D,u]=c.useState(!1),[m,E]=c.useState(null),[h,R]=c.useState(""),[P,L]=c.useState("DEV"),[C,M]=c.useState("north"),[y,N]=c.useState(!1),b=async()=>{var s,l,i;p(!0),j(null);try{const t=await k.get("/data/projects");n(t.data),m==null&&((s=t.data.projects)!=null&&s.length)&&E(t.data.projects[0].id)}catch(t){const a=t;((l=a.response)==null?void 0:l.status)===401||((i=a.response)==null?void 0:i.status)===403?j("Forbidden (403) — you are not authorized. Please log in again."):j("Failed to load projects. Check server logs.")}finally{p(!1)}};c.useEffect(()=>{b();const s=window.setInterval(b,3e4);return()=>window.clearInterval(s)},[]);const w=c.useMemo(()=>{var t;if(!r)return[];const s=r.apisMeta||{},l=new Map,i=((t=r.allApis)!=null&&t.length?r.allApis:r.apis)||[];for(const a of i){const x=s[String(a.id)]||{};let d=x.service;if(!d)try{d=new URL(a.url).hostname}catch{d="unknown-service"}const O=J(a.environment),A=l.get(d)||{service:d,byEnv:{}},I=A.byEnv[O]||{};I[a.region]={version:x.version,url:a.url,status:a.status||"unknown"},A.byEnv[O]=I,l.set(d,A)}return Array.from(l.values()).sort((a,x)=>a.service.localeCompare(x.service))},[r]),T=async()=>{var s,l;if(!(!m||!h)){N(!0);try{const i=await $.get(h,{timeout:8e3}),{version:t,service:a}=i.data||{};if(!t||!a){alert('The endpoint must return JSON like: {"version":"1.0.0","service":"api-name"}'),N(!1);return}await k.post(`/data/projects/${m}/apis`,{url:h.trim(),environment:P,region:C,version:t,service:a});try{await k.post("/proxy/check",{url:h.trim()})}catch{}u(!1),R(""),b()}catch(i){const t=i;((s=t.response)==null?void 0:s.status)===401||((l=t.response)==null?void 0:l.status)===403?alert("Unauthorized. Please log in again."):alert("URL check or save failed. Ensure the URL is reachable and returns the required JSON."),console.error(i)}finally{N(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl",children:e.jsx(f,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"All APIs"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Monitor and manage all your API endpoints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 bg-gray-100 px-3 py-2 rounded-lg",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsxs("span",{children:[w.length," Services"]})]}),e.jsxs("button",{onClick:()=>u(!0),disabled:!!g,className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Add API"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(z,{className:"h-6 w-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Authentication Error"}),e.jsx("p",{className:"text-red-700 mt-1",children:g}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:'Make sure your login saves a JWT into localStorage["token"].'})]})]})}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"Service Matrix"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o?"Refreshing services...":`Last updated ${r!=null&&r.fetchedAt?new Date(r.fetchedAt).toLocaleString():""}`})]}),e.jsxs("button",{onClick:b,disabled:o,className:"flex items-center space-x-2 px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:[e.jsx(q,{className:`h-4 w-4 ${o?"animate-spin":""}`}),e.jsx("span",{className:"text-sm",children:"Refresh"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("div",{className:"min-w-[900px] grid grid-cols-[1.2fr,1fr,1fr,1fr,1fr] gap-0 border border-gray-200 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 font-semibold bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 flex items-center",children:[e.jsx(f,{className:"h-4 w-4 mr-2 text-gray-600"}),"Service"]}),v.map(s=>e.jsx("div",{className:"px-4 py-3 font-semibold bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 text-center last:border-r-0",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s==="PROD"?"bg-red-100 text-red-800":s==="OAT"?"bg-orange-100 text-orange-800":s==="UAT"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s})},s)),w.map((s,l)=>e.jsxs(F.Fragment,{children:[e.jsx("div",{className:`px-4 py-4 border-r border-gray-200 flex items-center ${l%2===0?"bg-white":"bg-gray-50/50"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"p-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded",children:e.jsx(U,{className:"h-3 w-3 text-white"})}),e.jsx("span",{className:"font-medium text-gray-900",children:s.service})]})}),v.map(i=>{const t=s.byEnv[i]||{},a=Object.keys(t);return e.jsx("div",{className:`px-4 py-4 border-r border-gray-200 last:border-r-0 ${l%2===0?"bg-white":"bg-gray-50/50"}`,children:a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(x=>{const d=t[x];return e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 uppercase",children:x}),e.jsx(W,{status:d.status})]}),e.jsxs("div",{className:"text-sm font-mono text-gray-900 mb-1",children:["v",d.version||"?"]}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[180px] mb-2",children:d.url}),e.jsxs("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-1 text-xs text-blue-600 hover:text-blue-800 transition-colors",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:"Test"})]})]},x)})}):e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-400 text-sm italic",children:"No deployment"})})},`${s.service}-${i}`)})]},s.service)),!o&&w.length===0&&e.jsxs("div",{className:"col-span-5 px-6 py-12 text-center bg-gray-50/50",children:[e.jsx(f,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mb-2",children:"No APIs Yet"}),e.jsx("div",{className:"text-sm text-gray-500 mb-4",children:"Get started by adding your first API endpoint"}),e.jsxs("button",{onClick:()=>u(!0),disabled:!!g,className:"inline-flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:"Add First API"})]})]})]})})})]}),e.jsx(B,{open:D,onClose:()=>u(!1),title:"Add an API",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-xl hover:bg-gray-300 transition-colors font-medium",onClick:()=>u(!1),disabled:y,children:"Cancel"}),e.jsx("button",{className:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition-all duration-200 font-medium",disabled:!m||!h||y,onClick:T,children:y?"Saving…":"Save API"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project"}),e.jsxs("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:(m==null?void 0:m.toString())||"",onChange:s=>E(parseInt(s.target.value,10)),children:[e.jsx("option",{value:"",disabled:!0,children:"Select project"}),((r==null?void 0:r.projects)||[]).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API URL"}),e.jsx("input",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",placeholder:"https://api.example.com/health",value:h,onChange:s=>R(s.target.value)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 bg-blue-50 p-2 rounded-lg",children:[e.jsx("strong",{children:"Required:"})," Endpoint must return ",e.jsx("code",{className:"bg-white px-1 rounded",children:'{ "version": "x.y.z", "service": "name" }'})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region"}),e.jsxs("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:C,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"north",children:"North"}),e.jsx("option",{value:"paris",children:"Paris"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),e.jsx("select",{className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors",value:P,onChange:s=>L(s.target.value),children:v.map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]})})]})]})}export{X as default};
